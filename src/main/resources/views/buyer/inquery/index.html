<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layout/layout}">
<body>
  <div class="container" layout:fragment="content">
    <ul class="breadcrumb">
      <li>
        <a th:href="@{/}"><i class="fa fa-dashboard"></i> 首页</a>
      </li>
      <li><a href="#" class="active">价格管理</a></li>
      <li class="active">询价管理</li>
    </ul>
    <div class="search-content">
        <div class="search-cell width-18">
          <label for="date_range">时间: </label>
          <input type="text" name="daterange" value="" class="form-control" />
        </div>
        <div class="search-cell width-10">
          <label for="supplier_code">供应商编码：</label>
          <input type="text" id="supplier_code" class="form-control">
        </div>
        <div class="search-cell width-10">
          <label for="supplier_name">供应商名称:</label>
          <input type="text" id="supplier_name" class="form-control">
        </div>
        <div class="search-cell width-10">
          <label for="product_code">商品编码:</label>
          <input type="text" id="product_code" class="form-control">
        </div>
        <div class="search-cell width-10">
          <label for="product_name">商品名称:</label>
          <input type="text" id="product_name" class="form-control">
        </div>
        <div class="search-cell width-10">
          <label for="date_range">状态:</label>
          <select name="status" id="status" class="form-control">
            <option value=""></option>
            <option value="新建">新建</option>
            <option value="审核">审核</option>
            <option value="拒绝">拒绝</option>
            <option value="发布">发布</option>
          </select>
        </div>
        <div style="vertical-align: bottom" class="search-cell width-15 text-right">
          <button class="btn btn-default" id="btn_search"><i class="fa fa-search"></i> 查询</button>
          <a class="btn btn-primary" th:href="@{/buyer/inquery/add}"><i class="fa fa-plus-circle"></i>&nbsp; 新建</a>
        </div>
    </div>
    <div class="row">
      <div class="col-lg-12">
        <table id="example" class="table table-striped table-bordered nowrap table-striped table-hover" style="width: 100%">
        </table>
      </div>
    </div>
  </div>
</body>
</html>


<script th:inline="javascript">
	$.fn.dataTable.ext.search.push(function(settings, data, dataIndex) {
		var supplier_code = $('#supplier_code').val();
		var supplier_name = $('#supplier_name').val();
		var product_code = $('#product_code').val();
		var product_name = $('#product_name').val();
		var status = $('#status').val();

		if (data[3] == supplier_code || supplier_code == '') {
			if (data[4] == supplier_name || supplier_name == '') {
				if (data[9] == product_code || product_code == '') {
					if (data[10] == product_name || product_name == '') {
						if (data[6] == status || status == '') {
							return true;
						}
					}
				}
			}
		}
		return false;
	});
	
	$(document).ready(function() {
		$('input[name="daterange"]').daterangepicker(
			{
				opens : 'right',
				parentEl : 'body',
				locale : {
					format : 'YYYY/MM/DD'
				}
			},
			function(start, end, label) {
				console.log("A new date selection was made: "
						+ start.format('YYYY-MM-DD') + ' to '
						+ end.format('YYYY-MM-DD'));
			});

		var table = $('#example').DataTable({
			ajax : {
				url : /*[[@{/api/venpriceadjust/batch_get}]]*/'',
				data : function(data) {
					var filter = {
						rows_per_page : data.length,
						page_index : data.start / data.length + 1
					}
					return filter;
				},
				dataSrc : function(json) {
					if (json.errcode != 0) {
						alert(json.errmsg);
						json.recordsTotal = 0
						json.recordsFiltered = 0;
						json.venpriceadjustlist = [];
					} else {
						json.recordsTotal = json.row_count;
						json.recordsFiltered = json.row_count;
					}
					return json.venpriceadjustlist;
				},
			},

			columns : [ {
				data : 'ccode',
				title : '单据号',
				render: function (data, display, record) {
      	  var edit_url = /*[[@{/buyer/inquery/}]]*/'';
      	  edit_url +=  data + '/edit';
      	  return '<a href="' + edit_url + '">' + data  + '</a>';
        },
				defaultContent : ''
			}, {
				data : 'ddate',
				title : '调价日期',
				render: $.fn.date_renderer,
				defaultContent : ''
			}, {
				data : 'cdepname',
				title : '调价部门',
				defaultContent : ''
			}, {
				data : 'cpersonname',
				title : '调价业务员',
				defaultContent : ''
			}, {
				data : 'cmainmemo',
				title : '表头备注',
				defaultContent : ''
			}, {
				data : 'cmaker',
				title : '制单人',
				defaultContent : ''
			}, {
				data : 'cverifier',
				title : '审批人',
				defaultContent : ''
			}, {
				data : 'dverifydate',
				title : '审批日期',
				render: $.fn.date_renderer,
				defaultContent : ''
					
			} ],
		});

		$("#btn_search").click(function() {
			table.draw();
		});
	});
</script>