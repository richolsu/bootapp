<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/layout}">
<body>
	<div class="container" layout:fragment="content">
		<ul class="breadcrumb">
			<li><a th:href="@{/}"><i class="fa fa-dashboard"></i> 首页</a></li>
			<li><a th:href="@{/seller}">供应商用户管理</a></li>
			<li class="active" th:text="${account.id}?'用户详细':'新建用户'"></li>
		</ul>
		<div class="btn-group-bar">
			<div class="text-right">
				<a class="btn btn-primary" id="save"><i class="fa fa-save"></i> 保存</a> <a class="btn btn-danger" id="del" th:if="${account.id}"><i class="fa fa-remove"></i> 删除</a> <a class="btn btn-default" th:href="@{/seller}"><i class="fa fa-arrow-left"></i> 返回列表</a>
			</div>
		</div>
		<form id="form" th:action="@{/seller/update}" method="post">
			<input type="hidden" id="id" name="id" th:value="${account.id}"> 
			<input type="hidden" id="vendor" name="vendor" th:value="${account.vendor?.code}">
			<div class="panel panel-default">
				<div class="panel-body form-body">
					<div class="row">
						<div class="col-md-3 form-group">
							<label for="username">用户名: </label> <input type="text" name="username" id="username" class="form-control" th:value="${account.username}" readonly>
						</div>
						<div class="col-md-3 form-group">
							<label for="init_password">初始密码： </label> <input type="text" name="password" class="form-control" th:value="111" readonly>
						</div>
						<div class="col-md-2 form-group">
							<label for="state">状态: </label>
							<div class="ui toggle checkbox">
								<input type="checkbox" class="form-control" name="state" value="1" th:checked="${account.state}"> <label>启用 / 停用</label>
							</div>
						</div>
						<div class="col-md-2 form-group">
							<label for="start_date">启用日期: </label> <input type="text" class="form-control" readonly th:value="${#dates.format(account.startDate, 'yyyy-MM-dd')}">
						</div>
						<div class="col-md-2 form-group">
							<label for="stop_date">停用日期:</label> <input type="text" class="form-control" readonly th:value="${#dates.format(account.stopDate, 'yyyy-MM-dd')}">
						</div>
					</div>
					<hr />
					<div class="row">
						<div class="col-md-3">
							<label>供应商编码: </label> <input type="text" name="code" id="vendor_code" class="form-control select-vendor" readonly th:value="${account.vendor?.code}" />
						</div>
						<div class="col-md-3">
							<label>供应商名称: </label> <input type="text" id="vendor_name" class="form-control select-vendor" readonly th:value="${account.vendor?.name}" />
						</div>
						<div class="col-md-3">
							<label>供应商简称: </label> <input type="text" id="vendor_abbrname" class="form-control" readonly th:value="${account.vendor?.abbrname}" />
						</div>
						<div class="col-md-3">
							<label>所属类别: </label> <input type="text" id="vendor_sort_code" class="form-control" readonly th:value="${account.vendor?.vendorClass?.name}" />
						</div>
						<div class="col-md-3">
							<label>所属行业: </label> <input type="text" id="vendor_industry" class="form-control" readonly th:value="${account.vendor?.industry}" />
						</div>
						<div class="col-md-3">
							<label>开户银行: </label> <input type="text" id="vendor_bank_open" class="form-control" readonly th:value="${account.vendor?.bankOpen}" />
						</div>
						<div class="col-md-3">
							<label>银行账号: </label> <input type="text" id="vendor_bank_acc_number" class="form-control" readonly th:value="${account.vendor?.bankAccNumber}" />
						</div>
						<div class="col-md-3">
							<label>联系人: </label> <input type="text" id="vendor_contact" class="form-control" readonly th:value="${account.vendor?.contact}" />
						</div>
						<div class="col-md-3">
							<label>电话: </label> <input type="text" id="vendor_phone" class="form-control" readonly th:value="${account.vendor?.phone}" />
						</div>
						<div class="col-md-3">
							<label>传真: </label> <input type="text" id="vendor_fax" class="form-control" readonly th:value="${account.vendor?.fax}" />
						</div>
						<div class="col-md-3">
							<label>手机: </label> <input type="text" id="vendor_mobile" class="form-control" readonly th:value="${account.vendor?.mobile}" />
						</div>
						<div class="col-md-3">
							<label>Email地址: </label> <input type="text" id="vendor_email" class="form-control" readonly th:value="${account.vendor?.email}" />
						</div>
						<div class="col-md-6">
							<label>地址: </label> <input type="text" id="vendor_address" class="form-control" readonly th:value="${account.vendor?.address}" />
						</div>
					</div>
				</div>
			</div>
		</form>
		<div class="modal fade" id="vendor_dialog" tabindex="-1" role="dialog" aria-hidden="true">
			<div class="modal-dialog" role="document" style="width: 1000px;">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="exampleModalLabel">选择供应商</h5>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body form-horizontal">
						<div class="search-content">
							<div class="search-cell width-10">
								<label for="search_keyword">供应商编码/名称：</label> <input type="text" id="search_keyword" class="form-control">
							</div>
							<div style="vertical-align: bottom" class="search-cell width-15">
								<button class="btn btn-default" id="btn_search">
									<i class="fa fa-search"></i> 查询
								</button>
							</div>
						</div>
						<div class="row">
							<div class="col-lg-12">
								<table id="vendor_table" class="table table-striped table-bordered nowrap table-striped table-hover" style="width: 100%">
								</table>
							</div>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
						<button type="button" class="btn btn-primary" id="save_vendor">保存</button>
					</div>
				</div>
			</div>
		</div>
	</div>
</body>
</html>
<script th:inline="javascript">
	var edit_url = /*[[@{/seller/}]]*/'';

  var table, vendor_table;

  jQuery(document).ready(function() {
	  var is_add = $("#id").val().length == 0;

	  $("#save").click(function() {
		  jQuery(form).ajaxSubmit({
		    beforeSend : function() {
			    App.blockUI();
		    },
		    complete : function() {
			    App.unblockUI();
		    },
		    success : function(res, status, xhr, form) {
			    if (res.success == 1) {
				    App.showSuccessDialog("操作成功", function() {
					    window.location.href = edit_url + res.data.id + "/edit";
				    });
			    } else {
				    App.showErrorDialog("操作失败", res.errmsg);
			    }
		    },
		    error : function(res, status, xhr, form) {
			    App.showErrorDialog("操作失败", "请输入正确的值");
		    }
		  });
	  });

	  $("#del").click(function() {
		  App.showConfirmDialog('确定要删除吗?', function() {
			  var del_url = edit_url + $("#id").val() + "/delete";
			  $.get(del_url, function(data, status) {
				  App.showSuccessDialog("操作成功", function() {
					  window.location.href = edit_url;
				  });
			  });
		  });
	  });

	  if (is_add) {
		  $(".select-vendor").click(function() {
			  $('#vendor_dialog').modal('show');
		  });
	  }

	  $("#save_vendor").click(function() {
		  var selectedRows = vendor_table.rows('.selected').data();
		  if (selectedRows.length == 0) {
			  App.showErrorDialog("请选择一个供应商");
			  return;
		  }

		  var vendor = selectedRows[0];
		  $('#username').val(vendor.code);
		  $('#vendor').val(vendor.code);
		  $('#vendor_name').val(vendor.name);
		  $('#vendor_abbrname').val(vendor.abbrname);
		  $('#vendor_address').val(vendor.address);
		  $('#vendor_bank_acc_number').val(vendor.bank_acc_number);
		  $('#vendor_bank_open').val(vendor.bank_open);
		  $('#vendor_code').val(vendor.code);
		  $('#vendor_contact').val(vendor.contact);
		  $('#vendor_email').val(vendor.email);
		  $('#vendor_end_date').val(vendor.end_date);
		  $('#vendor_fax').val(vendor.fax);
		  $('#vendor_industry').val(vendor.industry);
		  $('#vendor_mobile').val(vendor.mobile);
		  $('#vendor_receive_site').val(vendor.receive_site);
		  $('#vendor_sort_code').val(vendor.sort_code);
		  $('#vendor_timestamp').val(vendor.timestamp);
		  $('#vendor_dialog').modal('hide');

	  });

	  $('.modal').on('shown.bs.modal', function() {
		  if (vendor_table) {
			  return;
		  }

		  vendor_table = $('#vendor_table').DataTable({
		    ordering : true,
		    select : {
			    style : 'single',
		    },
		    ajax : {
		      url : /*[[@{/vendor/listall}]]*/'',
		      data : function(data) {
			      var filter = {
			        rows_per_page : data.length,
			        page_index : data.start / data.length + 1,
			        order : data.columns[data.order[0].column].data,
			        dir : data.order[0].dir,
			        search : $('#search_keyword').val()
			      }
			      return filter;
		      },
		      dataSrc : function(json) {
			      json.recordsTotal = json.totalElements;
			      json.recordsFiltered = json.totalElements;
			      return json.content;
		      },
		    },
		    order : [ [ 1, 'asc' ] ],
		    columns : [ {
		    	data : null,
		      defaultContent : '',
		      //width: "150px",
		      orderable : false,
		      className : 'select-checkbox',
		    }, {
		      data : 'code',
		      title : '供应商编码',
		    }, {
		      data : 'name',
		      title : '供应商名称',
		    }, {
		      data : 'abbrname',
		      title : '供应商简称',
		    }, {
		      data : 'address',
		      title : '地址',
		    }, {
		      data : 'fax',
		      title : '传真 ',
		    }, {
		      data : 'email',
		      title : 'Email地址',
		    }, {
		      data : 'mobile',
		      className : 'dt-right',
		      title : '手机',
		    }],
		  });
	  });

  });
</script>
