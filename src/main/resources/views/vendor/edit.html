<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/layout}" >
<head>
</head>
<body>
  <div class="container"  layout:fragment="content">  
      <ul class="breadcrumb">
        <li>
          <a th:href="@{/}"><i class="fa fa-dashboard"></i> 首页</a>
        </li>
        <li sec:authorize="hasRole('ROLE_BUYER')"><a href="#">基础资料</a></li>
        <li sec:authorize="hasRole('ROLE_BUYER')"><a th:href="@{/vendor}">供应商档案表</a></li>
        <li sec:authorize="hasRole('ROLE_ADMIN')"><a th:href="@{/vendor}">供应商管理</a></li>
        <li class="active">详细信息</li>
      </ul>

      <div class="btn-group-bar">
        <div class="text-right">
          <a class="btn btn-primary" sec:authorize="hasRole('ROLE_BUYER')" id="save"><i class="fa fa-save"></i> 启用</a>  
          <a class="btn btn-primary" sec:authorize="hasRole('ROLE_BUYER')" id="delete"><i class="fa fa-remove"></i> 停用</a>
          <a class="btn btn-default" th:href="@{/vendor}"><i class="fa fa-arrow-left"></i> 返回列表</a>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-body">
        <form id="form" th:action="@{/vendor/update}" method="post">
          <div class="row">
              <div class="col-lg-4 col-md-4">
                <label>供应商编码: </label>
                <input type="text" name="code" class="form-control select-vendor" readonly th:value="${data.code}"/>
              </div>
              <div class="col-lg-4 col-md-4">
                <label>供应商名称: </label>
                <input type="text" class="form-control select-vendor" readonly  th:value="${data.name}"/>
              </div>
              <div class="col-lg-4 col-md-4">
                <label>供应商简称: </label>
                <input type="text" class="form-control" readonly th:value="${data.abbrname}"/>
              </div>

              <div class="col-lg-4 col-md-4 hidden">
                <label>所属地区: </label>
                <input type="text" class="form-control" readonly/>
              </div>
              <div class="col-lg-4 col-md-4">
                <label>所属类别: </label>
                <input type="text" class="form-control" readonly th:value="${data.sortCode}"/>
              </div>
              <div class="col-lg-4 col-md-4 hidden">
                <label>员工人数: </label>
                <input type="text" class="form-control" readonly/>
              </div>

              <div class="col-lg-4 col-md-4 hidden">
                <label>供应商总公司: </label>
                <input type="text" class="form-control" readonly/>
              </div>
              <div class="col-lg-4 col-md-4">
                <label>所属行业: </label>
                <input type="text" class="form-control" readonly th:value="${data.industry}"/>
              </div>
              <div class="col-lg-4 col-md-4 hidden">
                <label>对应客户: </label>
                <input type="text" class="form-control" readonly/>
              </div>

              <div class="col-lg-4 col-md-4 hidden">
                <label>币种: </label>
                <input type="text" class="form-control" readonly/>
              </div>
              <div class="col-lg-4 col-md-4 hidden">
                <label>税号: </label>
                <input type="text" class="form-control" readonly/>
              </div>
              <div class="col-lg-4 col-md-4 hidden">
                <label>注册资金: </label>
                <input type="text" class="form-control" readonly/>
              </div>

              <div class="col-lg-4 col-md-4">
                <label>开户银行: </label>
                <input type="text" class="form-control" readonly th:value="${data.bankOpen}"/>
              </div>
              <div class="col-lg-4 col-md-4">
                <label>银行账号: </label>
                <input type="text" class="form-control" readonly th:value="${data.bankAccNumber}"/>
              </div>
              <div class="col-lg-4 col-md-4 hidden">
                <label>法人: </label>
                <input type="text" class="form-control" readonly/>
              </div>

              <div class="col-lg-4 col-md-4 hidden">
                <label>税率: </label>
                <input type="text" class="form-control" readonly/>
              </div>
              <div class="col-lg-4 col-md-4 hidden">
                <label>分管部门: </label>
                <input type="text" class="form-control" readonly/>
              </div>
              <div class="col-lg-4 col-md-4 hidden">
                <label>专营业务员: </label>
                <input type="text" class="form-control" readonly/>
              </div>

              <div class="col-lg-4 col-md-4">
                <label>电话: </label>
                <input type="text" class="form-control" readonly th:value="${data.phone}"/>
              </div>
              <div class="col-lg-4 col-md-4">
                <label>传真: </label>
                <input type="text" class="form-control" readonly th:value="${data.fax}"/>
              </div>
              <div class="col-lg-4 col-md-4">
                <label>手机: </label>
                <input type="text" class="form-control" readonly th:value="${data.mobile}"/>
              </div>

              <div class="col-lg-4 col-md-4 hidden">
                <label>呼机: </label>
                <input type="text" class="form-control" readonly/>
              </div>
              <div class="col-lg-4 col-md-4 hidden">
                <label>邮政编码: </label>
                <input type="text" class="form-control" readonly/>
              </div>
              <div class="col-lg-4 col-md-4">
                <label>联系人: </label>
                <input type="text" class="form-control" readonly th:value="${data.contact}"/>
              </div>

              <div class="col-lg-4 col-md-4">
                <label>地址: </label>
                <input type="text" class="form-control" readonly th:value="${data.address}"/>
              </div>

              <div class="col-lg-4 col-md-4">
                <label>Email地址: </label>
                <input type="text" class="form-control" readonly th:value="${data.email}"/>
              </div>
              <div class="col-lg-4 col-md-4 hidden">
                <label>结算方式: </label>
                <input type="text" class="form-control" readonly/>
              </div>
              <div class="col-lg-4 col-md-4 hidden">
                <label>到货方式: </label>
                <input type="text" class="form-control" readonly/>
              </div>

              <div class="col-lg-12 col-md-12 hidden">
                <label>到货地址: </label>
                <input type="text" class="form-control" readonly/>
              </div>

              <div class="col-lg-4 col-md-4 hidden">
                <label>到货仓库: </label>
                <input type="text" class="form-control" readonly/>
              </div>
              <div class="col-lg-4 col-md-4 hidden">
                <label>建档人: </label>
                <input type="text" class="form-control" readonly/>
              </div>
              <div class="col-lg-4 col-md-4 hidden">
                <label>建档日期: </label>
                <input type="text" class="form-control" readonly/>
              </div>

              <div class="col-lg-4 col-md-4 hidden">
                <label>变更人: </label>
                <input type="text" class="form-control" readonly/>
              </div>
              <div class="col-lg-4 col-md-4">
                <label>变更日期: </label>
                <input type="text" class="form-control" readonly th:value="${data.timestamp}"/>
              </div>
              <div class="col-lg-4 col-md-4">
                <label>采购组织: </label>
                <input type="hidden" id="unit" name="unit" th:value="${data.unit?.id}">
                <input type="text" class="form-control select-unit" th:value="${data.unit?.name}" readonly>
              </div>
            </div>
			<div class="row">
				<div class="col-lg-12 col-md-12">
					<label for="provideclasses">供货类别:</label>
					<select multiple="true" name="provideclasses" id="provideclasses" class="form-control" th:each="provideClass : ${provideClassList}">
					</select>
				</div>
			</div>
            <div class="row" style="margin-top:15px;" th:each="account : ${accounts}">
              <div class="col-lg-2 col-md-2">
                <label for="document_date">联系人: </label>
                <input type="text" class="form-control" readonly th:value="${account.realname}">
              </div>
              <div class="col-lg-2 col-md-2">
                <label for="effective_date">手机:</label>
                <input type="text" class="form-control" readonly th:value="${account.mobile}">
              </div>
              
              <div class="col-lg-2 col-md-2">
                <label for="tax_rate">电话:</label>
                <input type="text" class="form-control" readonly th:value="${account.tel}">
              </div>
              <div class="col-lg-2 col-md-2">
                <label for="tax_rate">邮箱:</label>
                <input type="text" class="form-control" readonly th:value="${account.email}">
              </div>
              <div class="col-lg-2 col-md-2">
                <label for="document_date">微信: </label>
                <input type="text" class="form-control" readonly th:value="${account.weixin}">
              </div>
              <div class="col-lg-2 col-md-2">
                <label for="document_date">QQ: </label>
                <input type="text" class="form-control" readonly th:value="${account.qq}">
              </div>
              <div class="col-lg-2 col-md-2">
                <label for="document_date">雅虎通: </label>
                <input type="text" class="form-control" readonly th:value="${account.yahoo}">
              </div>
              <div class="col-lg-2 col-md-2">
                <label for="document_date">GTalk: </label>
                <input type="text" class="form-control" readonly th:value="${account.gtalk}">
              </div>
              <div class="col-lg-2 col-md-2">
                <label for="document_date">旺旺: </label>
                <input type="text" class="form-control" readonly th:value="${account.wangwang}">
              </div>                                                
              
              <div class="col-lg-6 col-md-6">
                <label for="address">通讯地址:</label>
                <input type="text" class="form-control" readonly th:value="${account.address}">
              </div>   
          </div>
        </form>
        </div>
        <div class="modal fade" id="vendor_dialog" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document" style="width:1000px;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">
                                                        选择供应商
                        </h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        </button>
                    </div>
                    <div class="modal-body form-horizontal">

                      <div class="search-content">
                          <div class="search-cell width-10">
                            <label for="search_keyword">供应商编码/名称：</label>
                            <input type="text" id="search_keyword" class="form-control">
                          </div>
                          <div style="vertical-align: bottom" class="search-cell width-15">
                            <button class="btn btn-default" id="btn_search"><i class="fa fa-search"></i> 查询</button>
                          </div>
                      </div>
                
                      <div class="row">
                        <div class="col-lg-12">
				            <table id="vendor_table" class="table table-striped table-bordered nowrap table-striped table-hover" style="width:100%">
				            </table>
				        </div>
				      </div>  
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
                        <button type="button" class="btn btn-primary" id="save_vendor">保存</button>
                    </div>
                </div>
            </div>
        </div>
  </div>  
  </div>
</body>
</html>

<script th:inline="javascript" sec:authorize="hasRole('ROLE_ADMIN')">
is_admin = 1;
</script>

<script th:inline="javascript">

/*[+
var search_url = [[@{/provideclass/search}]];
var tree_url = [[@{/unit/tree}]];  
var edit_url = [[@{/vendor/}]];
+]*/ 



$(document).ready(function() {

	var vendor_table;
	$("#provideclasses").select2(App.getSelect2TagOptions(search_url));
	
	var data = $.parseJSON(/*[[${provideClassList}]]*/'');
	$.each(data, function(key, item){
	  var option = new Option(item.name + '(' + item.code + ')', item.id, true, true);
	  $("#provideclasses").append(option);
	})
	$("#provideclasses").trigger('change');
  
	$('.modal').on('shown.bs.modal', function () {
	  if (vendor_table) {
		  return;
	  }
	  
	  vendor_table = $('#vendor_table').DataTable({
	      ordering: true,
	      select: true,
	      ajax : {
	          url : /*[[@{/vendor/list}]]*/'',
	          data : function(data) {
	              var filter = {
	                  rows_per_page : data.length,
	                  page_index : data.start / data.length + 1,
	                  order: data.columns[data.order[0].column].data,
	                  dir:data.order[0].dir,
	                  search: $('#search_keyword').val()
	              }
	              return filter;
	          },
	          dataSrc : function(json) {
	            json.recordsTotal = json.totalElements;
	            json.recordsFiltered = json.totalElements;
	            return json.content;
	          },
	      },
	      
	      columns : [ {
	          data : 'code',
	          title : '供应商编码',
	      }, {
	          data : 'name',
	          title : '供应商名称',
	      }, {
	          data : 'abbrname',
	          title : '供应商简称',
	      }, {
	          data : "unitname",
	          title : '采购组织',
	      }, {
	          data : 'address',
	          title : '地址',
	      }, {
	          data : 'bank_open',
	          title : '开户银行',
	      }, {
	          data : 'bank_acc_number',
	          title : '银行帐号',
	      }, {
	          data : 'fax',
	          title : '传真 ',
	      }, {
	          data : 'email',
	          title : 'Email地址',
	      }, {
	          data : 'mobile',
	          className: 'dt-right',
	          title : '手机',
	      }, {
	          data : 'receive_site',
	          title : '到货地址',                
	      }, {
	          data : 'end_date',
	          className: 'dt-center',
	          render : $.fn.date_renderer,
	          title : '停用日期',                
	      } ],
	  });
	});
  
  
  
	$(".select-vendor").click(function(){  //"select all" change
	  $('#vendor_dialog').modal('show');
	});
	
	$('#search_keyword').keyup(function(e){
	    if(e.keyCode == 13)
	  	  vendor_table.draw();
	});
  
	$("#btn_search").click(function() {
		vendor_table.draw();
	});
  
	$("#save").click(function() {
	    jQuery(form).ajaxSubmit({
	      beforeSend: function(){
	        App.blockUI();
	      },
	      complete: function(){
	        App.unblockUI();
	      },
	      success: function(res, status, xhr, form) {
	        App.showSuccessDialog("操作成功", function(){
	          window.location.href = edit_url + res.code + "/edit";
	        });
	      },
	      error: function (res, status, xhr, form) {
	        App.showErrorDialog("操作失败", "请输入正确的值");
	      }
	    });
	});
	
	$("#save_vendor").click(function() {
		var selectedRows = vendor_table.rows('.selected').data();
		if (selectedRows.length == 0) {
		  App.showErrorDialog("请选择一个供应商");
		  return;
		}	  
		$('#vendor_dialog').modal('hide');
	});
  

});

</script>
