<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/layout}">
<body>
  <div class="container"  layout:fragment="content">
    <ul class="breadcrumb">
      <li><a th:href="@{/}"><i class="fa fa-dashboard"></i>首页</a></li>
      <li><a href="#">订单管理</a></li>
      <li class="active">订单确认</li>
    </ul>

    <div class="search-content">
      <div class="search-cell width-18">
        <label for="date_range">时间: </label> 
        <input type="text" name="daterange" value="" class="form-control" />
      </div>
      <div class="search-cell width-15">
        <label for="supplier_code">类型: </label> 
        <input type="text" id="supplier_code" class="form-control">
      </div>
      <div class="search-cell width-10">
        <label for="date_range">状态:</label> 
        <select name="status" id="status" class="form-control">
          <option value=""></option>
          <option value="新建">新建</option>
          <option value="审核">审核</option>
          <option value="拒绝">拒绝</option>
          <option value="发布">发布</option>
        </select>
      </div>
      <div class="search-cell width-15">
        <label for="supplier_name">业务实体:</label> 
        <input type="text" id="supplier_name" class="form-control">
      </div>
      <div class="search-cell width-15">
        <label for="product_code">物品编码:</label> 
        <input type="text" id="product_code" class="form-control">
      </div>
      <div class="search-cell width-15">
        <label for="product_name">物品名称:</label> 
        <input type="text" id="product_name" class="form-control">
      </div>
      <div class="search-cell width-15">
        <label for="product_name">收货仓库:</label> 
        <input type="text" id="product_name" class="form-control">
      </div>
      <div style="vertical-align: bottom" class="search-cell width-6 text-right">
        <button class="btn btn-default" id="btn_search">
          <i class="fa fa-search"></i>
        </button>
      </div>
    </div>
    <div class="row">
        <div class="col-lg-12">
            <table id="example" class="table table-striped table-bordered nowrap table-striped table-hover" style="width:100%">
                <tbody><tr><td>　</td></tr></tbody>
            </table>
        </div>
      </div>
  </div>  
</body>
</html>


<script th:inline="javascript">
	
	$(document).ready(function() {
		var table = $('#example').DataTable({
			ajax : {
				url : /*[[@{/api/purchaseorder/batch_get}]]*/'',
				data : function(data) {
					var filter = {
						rows_per_page: data.length,
						page_index:data.start/data.length+1,
						name:$('#product_name').val()
					}
					return filter;
				},
				dataSrc : function(json) {
					if (json.errcode != 0) {
						alert(json.errmsg);
						json.recordsTotal = 0
						json.recordsFiltered = 0;
						json.purchaseorderlist = [];
					}else{
						json.recordsTotal = json.row_count;
						json.recordsFiltered = json.row_count;
					}
					return json.purchaseorderlist;
				},				
			},
			
			columns : [ {
				data : 'code',
				title : '订单编号',
				render: function (data, display, record) {
      	  var edit_url = /*[[@{/vendor/purchaseorder/}]]*/'';
      	  edit_url +=  data + '/edit';
      	  return '<a href="' + edit_url + '">' + data  + '</a>';
        },				
				defaultContent : ''
			}, {
				data : 'date',
				title : '订单日期',
				render: $.fn.date_renderer,
				defaultContent : ''
			}, {
				data : 'operation_type_code',
				title : '采购业务类型',
				defaultContent : ''
			}, {
				data : 'state',
				title : '订单状态',
				defaultContent : ''
			}, {
				data : 'purchase_type_code',
				title : '采购类型编码',
				defaultContent : ''
			}, {
				data : 'purchase_type_name',
				title : '采购类型',
				defaultContent : ''
			}, {
				data : 'vendorcode',
				title : '供应商编码',
				defaultContent : ''
			}, {
				data : 'vendorname',
				title : '供应商名称',
				defaultContent : ''
			}, {
				data : 'vendorabbname',
				title : '供应商简称',
				defaultContent : ''
			}, {
				data : 'deptcode',
				title : '部门编码',
				defaultContent : ''
			}, {
				data : 'deptcode',
				title : '部门编码',
				defaultContent : ''
			}, {
				data : 'deptname',
				title : '部门名称',
				defaultContent : ''
			}, {
				data : 'personcode',
				title : '业务员编码',
				defaultContent : ''
			}, {
				data : 'personname',
				title : '业务员',
				defaultContent : ''
			}, {
				data : 'remark',
				title : '备注',
				defaultContent : ''
			}, {
				data : 'currency_name',
				title : '外币名称',
				defaultContent : ''
			}, {
				data : 'currency_rate',
				title : '汇率',
				defaultContent : ''
			}, {
				data : 'maker',
				title : '制单人',
				defaultContent : ''
			}, {
				data : 'verifier',
				title : '审核人',
				defaultContent : ''
			}, {
				data : 'closer',
				title : '关闭人',
				defaultContent : ''
			}, {
				data : 'sum',
				title : '原币价税合计',
				defaultContent : ''
			} ],
		});
		
    $("#btn_search").click(function() {
    	table.draw();
    });
    
    $('#product_name').keyup(function(e){
        if(e.keyCode == 13)
        	table.draw();
    });
	});
</script>