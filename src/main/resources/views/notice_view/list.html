<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xmlns:th="http://www.thymeleaf.org" layout:decorate="~{layout/layout}">
<body>
	<div class="container" layout:fragment="content">
		<ul class="breadcrumb">
			<li><a th:href="@{/}"><i class="fa fa-dashboard"></i> 首页</a></li>
			<li class="active">采购动态</li>
		</ul>
		<div class="search-content">
			<div class="search-cell width-4">
				<label for="search">标题/内容：</label> <input type="text" id="search" class="form-control">
			</div>
			<div class="search-cell width-4">
				<label for="start_date">发布时间：</label> <input type="text" id="start_date" class="form-control datepicker">
			</div>
			<div class="search-cell width-4">
				<label for="end_date">&nbsp;</label> <input type="text" id="end_date" class="form-control datepicker">
			</div>
			<div class="search-cell width-3">
				<label for="state">分类：</label> 
				<select type="text" id="class_id" class="form-control">		
					<option th:if="${noticeClass != null}" th:value="${noticeClass?.id}" th:text="${noticeClass?.name}" selected="selected"></option>			
					<option th:if="${noticeClass == null}" th:value="-1" selected="selected"></option>
				</select>
			</div>
			<div class="search-cell width-4">
				<label for="create_account">创建人：</label> <input type="text" id="create_account" class="form-control">
			</div>
			<div style="vertical-align: bottom" class="search-cell width-10">
				<button class="btn btn-default" id="btn_search">
					<i class="fa fa-search"></i> 查询
				</button>
			</div>
		</div>
		<div class="row">
			<div class="col-lg-12">
				<table id="example" class="table table-striped table-bordered nowrap table-striped table-hover" style="width: 100%">
				</table>
			</div>
		</div>
	</div>
</body>
</html>
<script th:inline="javascript">
var notice_class_search_url = /*[[@{/notice_view/search/class}]]*/'';

	$(document).ready(function() {
	  var table;

	  $(".datepicker").datepicker({
		  onSelect : function(dateText) {
			  table.draw();
		  }
	  });

	  $("#class_id").select2(App.getSelect2OptionsWithAll(notice_class_search_url));
	  
	  table = $('#example').DataTable({
	    ordering : true,
	    ajax : {
	      url : /*[[@{/notice_view/list}]]*/'',
	      data : function(data) {
		      var filter = {
		        rows_per_page : data.length,
		        page_index : data.start / data.length + 1,
		        order : data.columns[data.order[0].column].data,
		        dir : data.order[0].dir,
		        search : $('#search').val(),
		        class_id : $('#class_id').val(),
		        start_date : $('#start_date').val(),
		        end_date : $('#end_date').val(),
		        create_account : $('#create_account').val()
		      }
		      return filter;
	      },
	      dataSrc : function(json) {
		      json.recordsTotal = json.totalElements;
		      json.recordsFiltered = json.totalElements;
		      return json.content;
	      },
	    },
	    order : [ [ 3, 'desc' ] ],
	    columns : [ {
	      data : 'title',
	      title : '标题',
	      render : function(data, display, record) {
		      var edit_url = /*[[@{/notice_view/}]]*/'';
		      edit_url += record.id + '/view';
		      return '<a href="' + edit_url + '">' + data + '</a>';
	      },
	    }, {
	      data : 'class_name',
	      className : 'dt-center',
	      title : '分类',
	    }, {
	      data : 'create_name',
	      className : 'dt-center',
	      title : '创建人',
	    }, {
	      data : 'verify_date',
	      title : '发布时间',
	      className : 'dt-center',
	      render : $.fn.time_renderer
	    } ],
	  });

	  $("#btn_search").click(function() {
		  table.draw();
	  });

	  $('#class_id').change(function() {
	    table.draw();
	  });
	  
	  $('#search, #start_date, #end_date, #create_account').keyup(function(e) {
		  if (e.keyCode == 13)
			  table.draw();
	  });
  });
</script>
